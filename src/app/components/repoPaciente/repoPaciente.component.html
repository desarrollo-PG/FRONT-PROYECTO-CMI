<div class="repo-pacientes-container content-area" [class.sidebar-expanded]="sidebarExpanded">
    <app-sidebar [userInfo]="userInfo"></app-sidebar>

    <div class="main-content">
        <header class="page-header">
            <h1>
            <div class="logo">
                <img src="assets/img/LogoFraijanes.png" alt="Logo Fraijanes">
            </div>
            Reportes de pacientes
            </h1>
        </header>
        
        <!-- Sección de Filtros -->
        <div class="filtros-card">
            <h3>Filtros de Búsqueda</h3>

            <div class="filtros-grid">
                <div class="filtro-grupo">
                <label for="filtroGenero">Género:</label>
                <select 
                    id="filtroGenero" 
                    [(ngModel)]="filtroGenero" 
                    (change)="aplicarFiltros()"
                    class="form-control"
                    [disabled]="cargando || exportando">
                    <option *ngFor="let opcion of opcionesGenero" [value]="opcion.value">
                    {{ opcion.label }}
                    </option>
                </select>
                </div>

                <div class="filtro-grupo">
                <label for="filtroEdad">Edad:</label>
                <select 
                    id="filtroEdad" 
                    [(ngModel)]="filtroEdad" 
                    (change)="aplicarFiltros()"
                    class="form-control"
                    [disabled]="cargando || exportando">
                    <option *ngFor="let opcion of opcionesEdad" [value]="opcion.value">
                    {{ opcion.label }}
                    </option>
                </select>
                </div>

                <div class="filtro-acciones">
                <button 
                    class="btn btn-secondary" 
                    (click)="limpiarFiltros()"
                    [disabled]="cargando || exportando">
                    <i class="fas fa-redo"></i> Limpiar
                </button>
                </div>
            </div>
        </div>

        <!-- Indicador de Carga -->
        <div *ngIf="cargando" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando pacientes...</p>
        </div>

        <!-- Indicador de Exportación -->
        <div *ngIf="exportando" class="loading-container">
        <div class="spinner"></div>
        <p>Generando archivo...</p>
        </div>

        <!-- Mensaje de Error -->
        <div *ngIf="error" class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        {{ error }}
        </div>

        <!-- Mensaje Sin Datos -->
        <div *ngIf="mostrarSinDatos && !cargando" class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        No se encontraron pacientes con los filtros seleccionados.
        </div>

        <!-- Tabla de Resultados -->
        <div *ngIf="!cargando && pacientesFiltrados.length > 0" class="tabla-card">
        <div class="tabla-header">
            <div class="tabla-header-info">
            <h3>Resultados</h3>
            <span class="badge">{{ pacientesFiltrados.length }} paciente(s) encontrado(s)</span>
            </div>
            
            <!-- Botones de Exportación -->
            <div class="tabla-acciones">
            <button 
                class="btn btn-success"
                (click)="exportarExcel()"
                [disabled]="exportando || pacientesFiltrados.length === 0"
                title="Exportar a Excel">
                <i class="fas fa-file-excel"></i>
                <span>Excel</span>
            </button>
            
            <button 
                class="btn btn-danger"
                (click)="exportarPDF()"
                [disabled]="exportando || pacientesFiltrados.length === 0"
                title="Exportar a PDF">
                <i class="fas fa-file-pdf"></i>
                <span>PDF</span>
            </button>
            
            <button 
                class="btn btn-primary"
                (click)="imprimirReporte()"
                [disabled]="exportando || pacientesFiltrados.length === 0"
                title="Imprimir">
                <i class="fas fa-print"></i>
                <span>Imprimir</span>
            </button>
            </div>
        </div>

        <div class="tabla-responsive">
            <table class="tabla-pacientes">
            <thead>
                <tr>
                <th>#</th>
                <th>Nombres</th>
                <th>Apellidos</th>
                <th>CUI</th>
                <th>Edad</th>
                <th>Género</th>
                <th>Teléfono</th>
                <th>Municipio</th>
                <th>Aldea</th>
                <th>Contacto Emergencia</th>
                <th>Teléfono Emergencia</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let paciente of pacientesFiltrados; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ paciente.nombres }}</td>
                <td>{{ paciente.apellidos }}</td>
                <td>{{ paciente.cui }}</td>
                <td>{{ calcularEdad(paciente.fechanacimiento) }} años</td>
                <td>
                    <span class="badge-genero" [class.masculino]="paciente.genero === 'M'" 
                        [class.femenino]="paciente.genero === 'F'">
                    {{ paciente.genero === 'M' ? 'Masculino' : 'Femenino' }}
                    </span>
                </td>
                <td>{{ paciente.telefonopersonal }}</td>
                <td>{{ paciente.municipio }}</td>
                <td>{{ paciente.aldea }}</td>
                <td>{{ paciente.nombrecontactoemergencia }}</td>
                <td>{{ paciente.telefonoemergencia }}</td>
                </tr>
            </tbody>
            </table>
        </div>
        </div>
    </div>
</div>