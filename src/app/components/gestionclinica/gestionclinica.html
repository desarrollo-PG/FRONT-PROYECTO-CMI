<div class="content-area" [class.sidebar-expanded]="sidebarExpanded"> 
  <app-sidebar 
    [userInfo]="userInfo"
    (sidebarToggle)="onSidebarToggle($event)">
  </app-sidebar>

  <div class="main-content">
    <header class="page-header">
      <h1>
        <div class="logo">
          <img src="assets/img/LogoFraijanes.png" alt="Logo Fraijanes">
        </div>
        {{ (dashboardData$ | async)?.config?.title || 'GESTIÓN CLÍNICA' }}
      </h1>
      <div class="date-info">
        Fecha: {{ formattedDate$ | async }}
      </div>
    </header>

    <div class="main-container" *ngIf="currentView === 'list'">
      <div class="controls-section">
        <div class="search-controls">
          <div class="search-container">
            <h2>{{ (dashboardData$ | async)?.config?.subtitle || 'Sistema de gestión' }}</h2>
            <p>Módulo: {{ (currentModule$ | async) | titlecase }}</p>
          </div>
        </div>
      </div>
      <div class="table-container">
        <div class="dashboard-content">
          <div class="dashboard-card">
            
            <!-- Módulos organizados en filas -->
            <div class="modules-container" 
                *ngIf="(dashboardData$ | async)?.activeModules as modules; else noModules">
              
              <!-- Primera fila de módulos (primeros 4) -->
              <div class="icons-grid" *ngIf="modules.length > 0">
                <div 
                  class="icon-item" 
                  *ngFor="let module of modules.slice(0, 4); trackBy: trackByModuleId" 
                  (click)="navigateTo(module.route)"
                  [attr.aria-label]="'Navegar a ' + module.name"
                  role="button"
                  tabindex="0"
                  (keydown.enter)="navigateTo(module.route)"
                  (keydown.space)="navigateTo(module.route)"
                >
                  <div class="icon-circle" [ngClass]="module.color">
                    <i [class]="module.icon" [attr.aria-hidden]="true"></i>
                    <div class="notification-badge" 
                        *ngIf="module.notification && module.notification > 0"
                        [attr.aria-label]="module.notification + ' notificaciones'">
                      {{ module.notification }}
                    </div>
                  </div>
                  <div class="icon-label">{{ module.name }}</div>
                  <div class="icon-description" *ngIf="module.description">
                    {{ module.description }}
                  </div>
                </div>
              </div>

              <!-- Divisor entre filas -->
              <div class="divider" *ngIf="modules.length > 4"></div>

              <!-- Segunda fila de módulos (módulos 5-8) -->
              <div class="icons-grid" *ngIf="modules.length > 4">
                <div 
                  class="icon-item" 
                  *ngFor="let module of modules.slice(4, 8); trackBy: trackByModuleId" 
                  (click)="navigateTo(module.route)"
                  [attr.aria-label]="'Navegar a ' + module.name"
                  role="button"
                  tabindex="0"
                  (keydown.enter)="navigateTo(module.route)"
                  (keydown.space)="navigateTo(module.route)"
                >
                  <div class="icon-circle" [ngClass]="module.color">
                    <i [class]="module.icon" [attr.aria-hidden]="true"></i>
                    <div class="notification-badge" 
                        *ngIf="module.notification && module.notification > 0"
                        [attr.aria-label]="module.notification + ' notificaciones'">
                      {{ module.notification }}
                    </div>
                  </div>
                  <div class="icon-label">{{ module.name }}</div>
                  <div class="icon-description" *ngIf="module.description">
                    {{ module.description }}
                  </div>
                </div>
              </div>

              <!-- Tercera fila si hay más de 8 módulos -->
              <div class="divider" *ngIf="modules.length > 8"></div>
              <div class="icons-grid" *ngIf="modules.length > 8">
                <div 
                  class="icon-item" 
                  *ngFor="let module of modules.slice(8); trackBy: trackByModuleId" 
                  (click)="navigateTo(module.route)"
                  [attr.aria-label]="'Navegar a ' + module.name"
                  role="button"
                  tabindex="0"
                  (keydown.enter)="navigateTo(module.route)"
                  (keydown.space)="navigateTo(module.route)"
                >
                  <div class="icon-circle" [ngClass]="module.color">
                    <i [class]="module.icon" [attr.aria-hidden]="true"></i>
                    <div class="notification-badge" 
                        *ngIf="module.notification && module.notification > 0"
                        [attr.aria-label]="module.notification + ' notificaciones'">
                      {{ module.notification }}
                    </div>
                  </div>
                  <div class="icon-label">{{ module.name }}</div>
                  <div class="icon-description" *ngIf="module.description">
                    {{ module.description }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Estado sin módulos configurados -->
            <ng-template #noModules>
              <div class="empty-state">
                <i class="fas fa-cogs" aria-hidden="true"></i>
                <h3>Módulo en configuración</h3>
                <p>Este módulo está siendo configurado. Pronto estará disponible.</p>
              </div>
            </ng-template>

            <!-- Acciones rápidas -->
            <div class="quick-actions" 
                *ngIf="(dashboardData$ | async)?.visibleActions as actions">
              <div *ngIf="hasQuickActions(actions)">
                <h3>Acciones Rápidas</h3>
                <div class="action-buttons">
                  <button 
                    class="action-btn" 
                    *ngFor="let action of actions; trackBy: trackByActionId"
                    (click)="quickAction(action.action)"
                    [attr.aria-label]="'Ejecutar acción: ' + action.label"
                    [disabled]="loading$ | async"
                  >
                    <i [class]="action.icon" [attr.aria-hidden]="true"></i>
                    {{ action.label }}
                  </button>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>