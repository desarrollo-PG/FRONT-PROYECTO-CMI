<!-- paciente-list.component.html -->
<div class="content-area" [class.sidebar-expanded]="barraLateralExpandida">
  <!-- Sidebar -->
  <app-sidebar [userInfo]="informacionUsuario"></app-sidebar>
  <div class="main-content">
    <header class="page-header">
      <h1>
        <div class="logo">
          <img src="assets/img/LogoFraijanes.png" alt="Logo Fraijanes">
        </div>
        Pacientes
      </h1>
      
      <div class="date-info">
        Fecha: {{ currentDate | date:'dd/MM/yy' }}
      </div>
    </header>

    <div class="main-container" *ngIf="vistaActual === 'lista'">
      <div class="controls-section">
        <div class="search-controls">
          <div class="search-container">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar"
              [(ngModel)]="searchTerm"
              (input)="filtrarPacientes()"
            >
          </div>
          <button class="add-btn" (click)="mostrarFormulario()" *ngIf="vistaActual === 'lista'">
            Nuevo Paciente
          </button>
        </div>
      </div>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nombre del Paciente</th>
              <th>Género</th>
              <th>Edad</th>
              <th>CUI</th>
              <th>Teléfono</th>
              <th>No. Expediente</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let paciente of paginatedPacientes; let i = index" class="table-row">
              <td class="user-name" (click)="verPaciente(paciente)">
                {{ paciente.nombres }} {{ paciente.apellidos }}
              </td>
              <td>{{ paciente.genero === 'M' ? 'Masculino' : 'Femenino' }}</td>
              <td>{{ calcularEdad(paciente.fechanacimiento) }} años</td>
              <td>{{ paciente.cui }}</td>
              <td>{{ paciente.telefonopersonal || 'No registrado' }}</td>
              <td>
                <span *ngIf="obtenerInformacionExpedientePaciente(paciente).tieneExpediente" 
                      class="insignia-expediente expediente-existe">
                  <i class="fas fa-file-medical"></i>
                  {{ obtenerInformacionExpedientePaciente(paciente).numeroExpediente }}
                </span>
                <span *ngIf="!obtenerInformacionExpedientePaciente(paciente).tieneExpediente" 
                      class="insignia-expediente expediente-faltante">
                  <i class="fas fa-file-plus"></i>
                  Asignar Expediente
                </span>
              </td>
              <!-- Columna de acciones con menú de tres puntos -->
              <td class="columna-acciones">
                <div class="action-buttons">
                  <!-- Editar -->
                  <button 
                    class="btn-action btn-edit" 
                    (click)="editarPaciente(paciente)"
                    title="Editar Paciente">
                    <i class="fas fa-edit"></i>
                  </button>

                  <!-- Eliminar -->
                  <button 
                    class="btn-action btn-delete" 
                    (click)="eliminarPaciente(paciente)"
                    title="Eliminar Paciente">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pagination" *ngIf="totalItems > 0">
        <!-- Navegación de páginas (solo si hay más de 1 página) -->
        <div class="pagination-info" *ngIf="totalPages > 1">
          <!-- Botón anterior -->
          <button 
            class="pagination-btn" 
            [class.disabled]="currentPage === 1"
            (click)="previousPage()"
            [disabled]="currentPage === 1"
          >
            <i class="fas fa-chevron-left"></i>
          </button>

          <!-- Primera página -->
          <button 
            *ngIf="getPages()[0] > 1"
            class="pagination-btn"
            (click)="goToPage(1)"
          >
            1
          </button>
          
          <!-- Puntos suspensivos si hay salto -->
          <span *ngIf="getPages()[0] > 2" class="pagination-dots">...</span>

          <!-- Páginas visibles -->
          <button 
            *ngFor="let page of getPages()"
            class="pagination-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>

          <!-- Puntos suspensivos si hay salto al final -->
          <span *ngIf="getPages()[getPages().length - 1] < totalPages - 1" class="pagination-dots">...</span>

          <!-- Última página -->
          <button 
            *ngIf="getPages()[getPages().length - 1] < totalPages"
            class="pagination-btn"
            (click)="goToPage(totalPages)"
          >
            {{ totalPages }}
          </button>

          <!-- Botón siguiente -->
          <button 
            class="pagination-btn" 
            [class.disabled]="currentPage === totalPages"
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
          >
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

        <!-- Mostrar mensaje si solo hay una página -->
        <div *ngIf="totalPages <= 1" class="pagination-single">
          Página 1 de 1
        </div>

        <!-- Selector de elementos por página -->
        <div class="items-per-page">
          <label>Mostrar:</label>
          <select [(ngModel)]="itemsPerPage" (ngModelChange)="onItemsPerPageChange()">
            <option [value]="5">5</option>
            <option [value]="10">10</option>
            <option [value]="20">20</option>
            <option [value]="50">50</option>
          </select>
          <span>por página</span>
        </div>
      </div>
      <div *ngIf="pacientesFiltrados.length === 0 && !cargando" class="estado-vacio">
        <i class="fas fa-users"></i>
        <h3>No se encontraron pacientes</h3>
        <p>No hay pacientes que coincidan con su búsqueda</p>
      </div>
    </div>
  </div>

  <!-- Indicador de subida de archivos -->
  <div *ngIf="subiendoArchivos" class="estado-subida">
    <div class="indicador-subida">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Subiendo archivos...</span>
    </div>
  </div>

  <!-- Modal de Acciones del Paciente (CORREGIDO) -->
  <div class="modal-backdrop" *ngIf="modalAccionesAbierto" (click)="cerrarModalAcciones()">
    <div class="modal-content-large" (click)="$event.stopPropagation()">
      
      <!-- Header del modal -->
      <div class="modal-header">
        <div class="paciente-info">
          <div class="paciente-avatar">
            <span>{{ obtenerIniciales(pacienteSeleccionadoAcciones?.nombres, pacienteSeleccionadoAcciones?.apellidos) }}</span>
          </div>
          <div class="paciente-datos">
            <h3 class="paciente-nombre-modal">{{ pacienteSeleccionadoAcciones?.nombres }} {{ pacienteSeleccionadoAcciones?.apellidos }}</h3>
            <p class="paciente-cui">CUI: {{ pacienteSeleccionadoAcciones?.cui }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="cerrarModalAcciones()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Acciones disponibles -->
      <div class="modal-body-scroll">
        
        <!-- Historial Clínico -->
        <button 
          class="accion-btn accion-historial" 
          (click)="verHistorialClinicoDesdeModal(pacienteSeleccionadoAcciones!)"
        >
          <div class="accion-icon">
            <i class="fas fa-file-medical-alt"></i>
          </div>
          <div class="accion-info">
            <span class="accion-titulo">Historial Clínico</span>
            <span class="accion-descripcion">Ver y gestionar historial médico</span>
          </div>
          <div class="accion-arrow">
            <i class="fas fa-chevron-right"></i>
          </div>
        </button>

        <!-- Editar Paciente -->
        <button 
          class="accion-btn accion-editar" 
          (click)="editarPacienteDesdeModal(pacienteSeleccionadoAcciones!)"
        >
          <div class="accion-icon">
            <i class="fas fa-user-edit"></i>
          </div>
          <div class="accion-info">
            <span class="accion-titulo">Editar Paciente</span>
            <span class="accion-descripcion">Modificar información personal</span>
          </div>
          <div class="accion-arrow">
            <i class="fas fa-chevron-right"></i>
          </div>
        </button>


        <!-- Separador -->
        <div class="accion-separador"></div>

        <!-- Eliminar Paciente -->
        <!-- <button 
          class="accion-btn accion-eliminar" 
          (click)="eliminarPacienteDesdeModal(pacienteSeleccionadoAcciones!)"
        >
          <div class="accion-icon">
            <i class="fas fa-trash-alt"></i>
          </div>
          <div class="accion-info">
            <span class="accion-titulo">Eliminar Paciente</span>
            <span class="accion-descripcion">Eliminar permanentemente</span>
          </div>
          <div class="accion-arrow">
            <i class="fas fa-chevron-right"></i>
          </div>
        </button> -->

      </div>

      <!-- Footer del modal -->
      <div class="modal-footer">
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cerrarModalAcciones()">
            <i class="fas fa-times"></i> Cerrar
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Modal de formulario -->
  <div class="modal-backdrop" *ngIf="vistaActual === 'formulario'" (click)="cerrarModal()">
    <div class="modal-content-large" (click)="$event.stopPropagation()">
      
      <!-- Encabezado del modal -->
      <div class="modal-header">
        <h3>{{ modoEdicion ? 'Editar Paciente' : 'Nuevo Paciente' }}</h3>
        <button class="modal-close" (click)="cerrarModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Cuerpo del modal con scroll -->
      <div class="modal-body-scroll">
        
        <!-- Sección de fotografías -->
        <div class="photo-section">          
          <div class="photo-upload">
            <div class="photo-preview">
              <img *ngIf="fotoSeleccionada" [src]="fotoSeleccionada" alt="Preview" class="photo-img">
              <div *ngIf="!fotoSeleccionada" class="photo-placeholder">
                <i class="fas fa-user-circle"></i>
                <span>Foto del paciente</span>
              </div>
            </div>
            <input 
              type="file" 
              #fileInput 
              (change)="alSeleccionarFoto($event, 'perfil')" 
              accept="image/*" 
              style="display: none;"
            >
            <button type="button" class="photo-btn" (click)="fileInput.click()">
              <i class="fas fa-camera"></i> Seleccionar foto
            </button>
            

            <!-- Foto del encargado -->
            <!-- <div class="tarjeta-foto">
              <div class="vista-previa-foto-circulo">
                <img *ngIf="fotoEncargadoSeleccionada" [src]="fotoEncargadoSeleccionada" alt="Foto Encargado" class="imagen-foto-circulo">
                <div *ngIf="!fotoEncargadoSeleccionada" class="marcador-posicion-foto-circulo">
                  <i class="fas fa-user-tie"></i>
                </div>
              </div>
              <label class="etiqueta-foto">Foto del encargado</label>
              <input 
                type="file" 
                #entradaArchivoEncargado 
                (change)="alSeleccionarFoto($event, 'encargado')" 
                accept="image/*" 
                style="display: none;"
              >
              <button type="button" class="boton-subir-foto" (click)="entradaArchivoEncargado.click()">
                <i class="fas fa-camera"></i>
                {{ fotoEncargadoSeleccionada ? 'Cambiar Foto' : 'Seleccionar Foto' }}
              </button>
              <button 
                *ngIf="fotoEncargadoSeleccionada" 
                type="button" 
                class="boton-eliminar-foto" 
                (click)="eliminarFoto('encargado')"
              >
                <i class="fas fa-trash"></i> Eliminar
              </button>
            </div> -->
          </div>
        </div>

        <!-- Sección de documentos -->
        <!-- <div class="photo-section">
          <h4 class="titulo-seccion">
            <i class="fas fa-file-contract"></i> Documentos Adicionales (Opcional)
          </h4>
          
          <div class="tarjeta-foto">
            <div class="vista-previa-foto-circulo" style="border-radius: 8px;">
              <div class="vista-previa-documento" *ngIf="cartaSeleccionada">
                <div class="icono-documento" *ngIf="esCartaPDF">
                  <i class="fas fa-file-pdf"></i>
                  <span>PDF</span>
                </div>
                <img *ngIf="!esCartaPDF" [src]="cartaSeleccionada" alt="Carta Autorización" class="imagen-foto-circulo">
              </div>
              <div *ngIf="!cartaSeleccionada" class="marcador-posicion-foto-circulo">
                <i class="fas fa-file-upload"></i>
              </div>
            </div>
            
            <label class="etiqueta-foto">Carta de Autorización</label>
            
            <input 
              type="file" 
              #entradaArchivoCarta 
              (change)="alSeleccionarFoto($event, 'carta')" 
              accept="image/*,application/pdf" 
              style="display: none;"
            >
            <button type="button" class="boton-subir-foto" (click)="entradaArchivoCarta.click()">
              <i class="fas fa-upload"></i>
              {{ cartaSeleccionada ? 'Cambiar Documento' : 'Subir Documento' }}
            </button>
            <button 
              *ngIf="cartaSeleccionada" 
              type="button" 
              class="boton-eliminar-foto" 
              (click)="eliminarFoto('carta')"
            >
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        </div> -->

        <!-- Formulario de datos del paciente -->
        <form [formGroup]="formularioPaciente" class="user-form">
          
          <!-- Información personal -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-user"></i> Información Personal
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Nombres *</label>
                <input 
                  type="text" 
                  formControlName="nombres"
                  class="form-input"
                  [class.error]="esCampoInvalido('nombres')"
                  placeholder="Ingrese los nombres completos"
                >
                <div *ngIf="esCampoInvalido('nombres')" class="error-message">{{ obtenerErrorCampo('nombres') }}</div>
              </div>

              <div class="form-group">
                <label>Apellidos *</label>
                <input 
                  type="text" 
                  formControlName="apellidos"
                  class="form-input"
                  [class.error]="esCampoInvalido('apellidos')"
                  placeholder="Ingrese los apellidos completos"
                >
                <div *ngIf="esCampoInvalido('apellidos')" class="error-message">{{ obtenerErrorCampo('apellidos') }}</div>
              </div>

              <div class="form-group">
                <label>CUI (Código Único de Identificación) *</label>
                <input 
                  type="text" 
                  formControlName="cui"
                  class="form-input"
                  [class.error]="esCampoInvalido('cui')"
                  placeholder="1234567890123 (13 dígitos)"
                  maxlength="13"
                >
                <div *ngIf="esCampoInvalido('cui')" class="error-message">{{ obtenerErrorCampo('cui') }}</div>
              </div>

              <div class="form-group">
                <label>Fecha de Nacimiento *</label>
                <input 
                  type="date" 
                  formControlName="fechanacimiento"
                  class="form-input"
                  [class.error]="esCampoInvalido('fechanacimiento')"
                >
                <div *ngIf="esCampoInvalido('fechanacimiento')" class="error-message">{{ obtenerErrorCampo('fechanacimiento') }}</div>
              </div>

              <div class="form-group">
                <label>Género *</label>
                <select formControlName="genero" class="form-input" [class.error]="esCampoInvalido('genero')">
                  <option value="">Seleccionar género</option>
                  <option value="M">Masculino</option>
                  <option value="F">Femenino</option>
                </select>
                <div *ngIf="esCampoInvalido('genero')" class="error-message">{{ obtenerErrorCampo('genero') }}</div>
              </div>

              <div class="form-group">
                <label>Tipo de Consulta *</label>
                <input 
                  type="text" 
                  formControlName="tipoconsulta" 
                  class="form-input" 
                  [class.error]="esCampoInvalido('tipoconsulta')"
                  placeholder="Ej: Primera vez, Subsecuente, Urgencia"
                  list="listaTipoConsulta"
                >
                <datalist id="listaTipoConsulta">
                  <option value="Primera vez">
                  <option value="Subsecuente">
                  <option value="Urgencia">
                  <option value="Consulta General">
                  <option value="Control">
                </datalist>
                <div *ngIf="esCampoInvalido('tipoconsulta')" class="error-message">{{ obtenerErrorCampo('tipoconsulta') }}</div>
              </div>
            </div>
          </div>

          <!-- Información de contacto -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-phone"></i> Información de Contacto
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Teléfono Personal</label>
                <input 
                  type="text" 
                  formControlName="telefonopersonal"
                  class="form-input"
                  placeholder="+502 4444-4444"
                  maxlength="14"
                  appPhoneFormat
                >
              </div>

              <div class="form-group">
                <label>Nombre del Contacto de Emergencia</label>
                <input 
                  type="text" 
                  formControlName="nombrecontactoemergencia"
                  class="form-input"
                  placeholder="Nombre completo del contacto"
                >
              </div>

              <div class="form-group">
                <label>Teléfono de Emergencia</label>
                <input 
                  type="text" 
                  formControlName="telefonoemergencia"
                  class="form-input"
                  placeholder="+502 4444-4444"
                  maxlength="14"
                  appPhoneFormat
                >
              </div>
            </div>
          </div>

          <!-- Información del encargado -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-user-friends"></i> Información del Encargado/Responsable
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre del Encargado</label>
                <input 
                  type="text" 
                  formControlName="nombreencargado"
                  class="form-input"
                  placeholder="Nombre completo del encargado o responsable"
                >
              </div>

              <div class="form-group">
                <label>DPI del Encargado</label>
                <input 
                  type="text" 
                  formControlName="dpiencargado"
                  class="form-input"
                  placeholder="1234567890101"
                  maxlength="13"
                >
              </div>

              <div class="form-group">
                <label>Teléfono del Encargado</label>
                <input 
                  type="text" 
                  formControlName="telefonoencargado"
                  class="form-input"
                  placeholder="+502 4444-4444"
                  maxlength="14"
                  appPhoneFormat
                >
              </div>
            </div>
          </div>

          <!-- Información adicional -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-info-circle"></i> Información Médica Adicional
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Tipo de Discapacidad</label>
                <input 
                  type="text" 
                  formControlName="tipodiscapacidad" 
                  class="form-input"
                  placeholder="Ej: Ninguna, Física, Visual, Auditiva"
                  list="listaTipoDiscapacidad"
                >
                <datalist id="listaTipoDiscapacidad">
                  <option value="Ninguna">
                  <option value="Física">
                  <option value="Visual">
                  <option value="Auditiva">
                  <option value="Intelectual">
                  <option value="Psicosocial">
                  <option value="Múltiple">
                  <option value="Otra">
                </datalist>
              </div>
            </div>
          </div>

          <!-- Información de dirección -->
          <div class="form-section">
            <h4 class="section-title">
              <i class="fas fa-map-marker-alt"></i> Información de Ubicación
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Municipio *</label>
                <input 
                  type="text" 
                  formControlName="municipio"
                  class="form-input"
                  [class.error]="esCampoInvalido('municipio')"
                  placeholder="Nombre del municipio"
                >
                <div *ngIf="esCampoInvalido('municipio')" class="error-message">{{ obtenerErrorCampo('municipio') }}</div>
              </div>

              <div class="form-group">
                <label>Aldea/Zona/Colonia</label>
                <input 
                  type="text" 
                  formControlName="aldea"
                  class="form-input"
                  placeholder="Aldea, zona o colonia"
                >
              </div>

              <div class="form-group ancho-completo">
                <label>Completar Dirección *</label>
                <textarea
                  formControlName="direccion"
                  class="form-input"
                  [class.error]="esCampoInvalido('direccion')"
                  rows="3"
                  placeholder="Ingrese la dirección detallada del paciente"
                ></textarea>
                <div *ngIf="esCampoInvalido('direccion')" class="error-message">{{ obtenerErrorCampo('direccion') }}</div>
              </div>
            </div>
          </div>

        </form>
      </div>

      <!-- Pie del modal fijo -->
      <div class="modal-footer">
        <div *ngIf="isViewMode" class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cerrarModal()">
            <i class="fas fa-times"></i> Cerrar
          </button>
        </div>
        <div *ngIf="!isViewMode" class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cerrarModal()">
            <i class="fas fa-times"></i> Cancelar
          </button>
          <button 
            type="button"
            class="btn-save" 
            (click)="alEnviar()"
            [disabled]="formularioPaciente.invalid || cargando"
          >
            <span *ngIf="cargando">
              <i class="fas fa-spinner fa-spin"></i> Guardando...
            </span>
            <span *ngIf="!cargando">
              <i class="fas fa-save"></i> {{ modoEdicion ? ' Actualizar' : ' Crear' }} Paciente
            </span>
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- ===== VISTA DE DETALLE MEJORADA CON FOTOS Y ARCHIVOS ===== -->
  <div class="modal-backdrop" *ngIf="vistaActual === 'detalle'" (click)="mostrarLista()">
    <div class="modal-content-large" (click)="$event.stopPropagation()">
      
      <!-- Header -->
      <div class="modal-header">
        <h3>
          <i class="fas fa-info-circle"></i>
          Información Completa del Paciente
        </h3>
        <button class="btn-close" (click)="mostrarLista()" type="button">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Body -->
      <div class="modal-body-scroll" *ngIf="pacienteSeleccionado">
        
        <!-- FOTOS -->
        <div class="photo-section">
          <div class="photo-upload">
            <div class="photo-preview">
              <img 
                *ngIf="pacienteSeleccionado.rutafotoperfil" 
                [src]="archivoService.obtenerUrlPublica(pacienteSeleccionado.rutafotoperfil)" 
                [alt]="pacienteSeleccionado.nombres"
                class="photo-img"
                (error)="onImageError($event)">
              <div *ngIf="!pacienteSeleccionado.rutafotoperfil" class="photo-placeholder">
                <i class="fas fa-user"></i>
                <span>Sin foto</span>
              </div>
            </div>
          </div>
        </div>

        <form class="user-form">
          <!-- INFORMACIÓN PERSONAL -->
          <div class="form-section">
            <div class="section-title">
              <i class="fas fa-user"></i>
              Información Personal
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>Nombres:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.nombres" readonly>
              </div>
              <div class="form-group">
                <label>Apellidos:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.apellidos" readonly>
              </div>
              <div class="form-group">
                <label>CUI:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.cui" readonly>
              </div>
              <div class="form-group">
                <label>Fecha de Nacimiento:</label>
                <input type="text" class="form-input" [value]="formatearFecha(pacienteSeleccionado.fechanacimiento)" readonly>
              </div>
              <div class="form-group">
                <label>Edad:</label>
                <input type="text" class="form-input" [value]="calcularEdad(pacienteSeleccionado.fechanacimiento) + ' años'" readonly>
              </div>
              <div class="form-group">
                <label>Género:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.genero === 'M' ? 'Masculino' : 'Femenino'" readonly>
              </div>
              <div class="form-group">
                <label>Tipo de Consulta:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.tipoconsulta" readonly>
              </div>
              <div class="form-group">
                <label>Tipo de Discapacidad:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.tipodiscapacidad || 'Ninguna'" readonly>
              </div>
            </div>
          </div>

          <!-- INFORMACIÓN DE CONTACTO -->
          <div class="form-section">
            <div class="section-title">
              <i class="fas fa-phone"></i>
              Información de Contacto
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>Teléfono Personal:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.telefonopersonal || 'No registrado'" readonly>
              </div>
              <div class="form-group">
                <label>Contacto de Emergencia:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.nombrecontactoemergencia || 'No registrado'" readonly>
              </div>
              <div class="form-group">
                <label>Teléfono de Emergencia:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.telefonoemergencia || 'No registrado'" readonly>
              </div>
            </div>
          </div>

          <!-- INFORMACIÓN DEL ENCARGADO -->
          <div class="form-section">
            <div class="section-title">
              <i class="fas fa-user-friends"></i>
              Información del Encargado
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre del Encargado:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.nombreencargado || 'No registrado'" readonly>
              </div>
              <div class="form-group">
                <label>DPI del Encargado:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.dpiencargado || 'No registrado'" readonly>
              </div>
              <div class="form-group">
                <label>Teléfono del Encargado:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.telefonoencargado || 'No registrado'" readonly>
              </div>
            </div>
          </div>

          <!-- INFORMACIÓN DE UBICACIÓN -->
          <div class="form-section">
            <div class="section-title">
              <i class="fas fa-map-marker-alt"></i>
              Información de Ubicación
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label>Municipio:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.municipio" readonly>
              </div>
              <div class="form-group">
                <label>Aldea/Zona/Colonia:</label>
                <input type="text" class="form-input" [value]="pacienteSeleccionado.aldea || 'No especificado'" readonly>
              </div>
              <div class="form-group full-width">
                <label>Completar Dirección:</label>
                <textarea class="form-textarea" [value]="pacienteSeleccionado.direccion" readonly></textarea>
              </div>
            </div>
          </div>

          <!-- INFORMACIÓN DE EXPEDIENTE -->
          <div class="form-section" *ngIf="pacienteSeleccionado.expedientes && pacienteSeleccionado.expedientes.length > 0">
            <div class="section-title">
              <i class="fas fa-file-medical"></i>
              Información del Expediente
            </div>
            <div class="form-grid">
              <div *ngFor="let expediente of pacienteSeleccionado.expedientes">
                <div class="form-group full-width">
                  <label>Expediente N°:</label>
                  <input type="text" class="form-input" [value]="expediente.numeroexpediente" readonly>
                </div>
                <div class="form-group full-width" *ngIf="expediente.historiaenfermedad">
                  <label>Historia de la Enfermedad:</label>
                  <textarea class="form-textarea" [value]="expediente.historiaenfermedad" readonly></textarea>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="cerrarModal()">
            <i class="fas fa-times"></i> Cerrar
          </button>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Modal de expediente médico -->
  <div *ngIf="vistaActual === 'modal-expediente'" class="contenedor-modal-expediente">
    <div class="contenedor-modal-expediente">
      <div class="encabezado-modal-expediente">
        <h3>Crear Expediente Médico</h3>
        <button class="cerrar-modal" (click)="cerrarModalExpediente()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="contenido-modal-expediente">
        <app-expediente-lista 
          [mostrarComoModal]="true"
          [datosPaciente]="datosExpedientePaciente"
          (cerrarModal)="cerrarModalExpediente()"
          (expedienteCreado)="cerrarModalExpediente()">
        </app-expediente-lista>
      </div>
    </div>
  </div>

</div>